# ğŸˆ Runbook d'Exploitation - Seahawks Monitoring System

**Version:** 1.0.0  
**Date:** 26 janvier 2026  
**Audience:** Techniciens N1/N2  
**Classification:** Interne

---

## Table des matiÃ¨res

1. [Vue d'ensemble](#1-vue-densemble)
2. [Architecture systÃ¨me](#2-architecture-systÃ¨me)
3. [ProcÃ©dures de dÃ©ploiement](#3-procÃ©dures-de-dÃ©ploiement)
4. [OpÃ©rations courantes](#4-opÃ©rations-courantes)
5. [DÃ©pannage](#5-dÃ©pannage)
6. [Maintenance](#6-maintenance)
7. [Contacts et escalade](#7-contacts-et-escalade)

---

## 1. Vue d'ensemble

### 1.1 Objectif du systÃ¨me

Le Seahawks Monitoring System supervise 32 franchises de football amÃ©ricain avec deux composants principaux :

- **Seahawks Harvester** : Agent local sur chaque franchise (scan rÃ©seau)
- **Seahawks Nester** : Application centralisÃ©e Ã  Roubaix (supervision)

### 1.2 PrÃ©requis

**Harvester (par franchise):**
- VM Linux ou conteneur
- Python 3.11+
- nmap installÃ©
- 2 GB RAM minimum
- 10 GB disque

**Nester (datacenter):**
- Serveur Linux
- Python 3.11+ ou Docker
- 4 GB RAM minimum
- 50 GB disque
- Port 8000 ouvert

---

## 2. Architecture systÃ¨me

### 2.1 Composants

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATACENTER ROUBAIX                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Seahawks Nester (Port 8000)                   â”‚ â”‚
â”‚  â”‚  - Dashboard web                                      â”‚ â”‚
â”‚  â”‚  - API REST                                           â”‚ â”‚
â”‚  â”‚  - Base de donnÃ©es (fichiers JSON)                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â–²                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              Internet / WANâ”‚
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Franchise 01 â”‚  â”‚ Franchise 02   â”‚  â”‚ Franchise ... â”‚
â”‚              â”‚  â”‚                â”‚  â”‚               â”‚
â”‚ Harvester    â”‚  â”‚ Harvester      â”‚  â”‚ Harvester     â”‚
â”‚ (Scan local) â”‚  â”‚ (Scan local)   â”‚  â”‚ (Scan local)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Flux de donnÃ©es

1. **Harvester** scanne le rÃ©seau local toutes les heures
2. GÃ©nÃ¨re un rapport JSON horodatÃ©
3. Upload le rapport vers **Nester** via API REST
4. **Nester** agrÃ¨ge et affiche les donnÃ©es sur le dashboard

---

## 3. ProcÃ©dures de dÃ©ploiement

### 3.1 DÃ©ploiement du Harvester (sur site franchise)

#### Option A : Installation locale

```bash
# 1. Cloner le dÃ©pÃ´t
cd /opt
git clone https://github.com/seahawks/monitoring.git
cd monitoring/seahawks-harvester

# 2. CrÃ©er l'environnement virtuel
python3 -m venv venv
source venv/bin/activate

# 3. Installer les dÃ©pendances
pip install -r requirements.txt

# 4. Installer nmap
sudo apt-get update
sudo apt-get install -y nmap

# 5. Configurer la franchise
nano config.json
```

**Configuration type (config.json):**

```json
{
  "franchise_id": "franchise_01",
  "franchise_name": "Seattle Seahawks",
  "scan_network": "192.168.1.0/24",
  "scan_ports": "22,80,443,3389,8080",
  "wan_test_host": "8.8.8.8",
  "report_dir": "reports",
  "log_dir": "logs",
  "scan_interval": 3600,
  "nester_url": "http://nester.seahawks-monitoring.com:8000"
}
```

```bash
# 6. Tester le scan
python harvester.py

# 7. DÃ©marrer le dashboard local (optionnel)
python dashboard.py &

# 8. CrÃ©er un service systemd
sudo nano /etc/systemd/system/seahawks-harvester.service
```

**Fichier service:**

```ini
[Unit]
Description=Seahawks Harvester
After=network.target

[Service]
Type=simple
User=harvester
WorkingDirectory=/opt/monitoring/seahawks-harvester
ExecStart=/opt/monitoring/seahawks-harvester/venv/bin/python harvester.py
Restart=always
RestartSec=3600

[Install]
WantedBy=multi-user.target
```

```bash
# 9. Activer et dÃ©marrer le service
sudo systemctl daemon-reload
sudo systemctl enable seahawks-harvester
sudo systemctl start seahawks-harvester

# 10. VÃ©rifier le statut
sudo systemctl status seahawks-harvester
```

#### Option B : DÃ©ploiement Docker

```bash
# 1. Cloner le dÃ©pÃ´t
cd /opt
git clone https://github.com/seahawks/monitoring.git
cd monitoring/seahawks-harvester

# 2. Configurer
nano config.json

# 3. Construire l'image
docker build -t seahawks-harvester:1.0.0 .

# 4. DÃ©marrer le conteneur
docker run -d \
  --name harvester \
  --network host \
  --cap-add=NET_RAW \
  --cap-add=NET_ADMIN \
  -v $(pwd)/config.json:/app/config.json:ro \
  -v $(pwd)/reports:/app/reports \
  -v $(pwd)/logs:/app/logs \
  --restart unless-stopped \
  seahawks-harvester:1.0.0

# 5. VÃ©rifier les logs
docker logs -f harvester
```

### 3.2 DÃ©ploiement du Nester (datacenter)

#### Option Docker (recommandÃ©)

```bash
# 1. Cloner le dÃ©pÃ´t
cd /opt
git clone https://github.com/seahawks/monitoring.git
cd monitoring/seahawks-nester

# 2. CrÃ©er le fichier .env
nano .env
```

**Fichier .env:**

```bash
SECRET_KEY=votre-cle-secrete-tres-longue-et-aleatoire-changez-moi
FLASK_ENV=production
```

```bash
# 3. DÃ©marrer avec Docker Compose
docker-compose up -d

# 4. VÃ©rifier le statut
docker-compose ps
docker-compose logs -f

# 5. Tester l'accÃ¨s
curl http://localhost:8000/api/status
```

#### Configuration Nginx (reverse proxy)

```bash
sudo nano /etc/nginx/sites-available/seahawks-nester
```

**Configuration Nginx:**

```nginx
server {
    listen 80;
    server_name nester.seahawks-monitoring.com;

    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

```bash
# Activer le site
sudo ln -s /etc/nginx/sites-available/seahawks-nester /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

## 4. OpÃ©rations courantes

### 4.1 VÃ©rifier l'Ã©tat d'une franchise

**Dashboard web:**
1. AccÃ©der Ã  http://nester.seahawks-monitoring.com
2. Rechercher la franchise dans la liste
3. Statut affichÃ© : âœ… ConnectÃ© ou âŒ DÃ©connectÃ©

**Via API:**

```bash
# Lister toutes les sondes
curl http://nester.seahawks-monitoring.com:8000/api/probes

# DÃ©tail d'une sonde spÃ©cifique
curl http://nester.seahawks-monitoring.com:8000/api/probe/franchise_01

# Dernier rapport
curl http://nester.seahawks-monitoring.com:8000/api/probe/franchise_01/report
```

### 4.2 Lancer un scan manuel

**Sur la franchise (SSH):**

```bash
# Se connecter
ssh admin@franchise-01.seahawks.local

# Aller dans le rÃ©pertoire
cd /opt/monitoring/seahawks-harvester

# Lancer le scan
python harvester.py
```

**Via Docker:**

```bash
docker exec harvester python harvester.py
```

### 4.3 Consulter les logs

**Harvester:**

```bash
# Logs locaux
tail -f /opt/monitoring/seahawks-harvester/logs/harvester_*.log

# Logs Docker
docker logs -f harvester
```

**Nester:**

```bash
# Logs Docker Compose
docker-compose logs -f nester

# Logs locaux
tail -f /opt/monitoring/seahawks-nester/data/logs/nester_*.log
```

### 4.4 Consulter un rapport de scan

**Format JSON:**

```bash
# Dernier rapport
cat /opt/monitoring/seahawks-harvester/reports/latest_report.json | jq

# Rapport spÃ©cifique
cat /opt/monitoring/seahawks-harvester/reports/scan_report_20260126_103000.json | jq
```

**Champs importants:**

- `summary.hosts_up` : Nombre d'hÃ´tes actifs
- `summary.total_ports_open` : Ports ouverts dÃ©tectÃ©s
- `wan_latency_ms` : Latence WAN en millisecondes
- `scan_duration_seconds` : DurÃ©e du scan

---

## 5. DÃ©pannage

### 5.1 ProblÃ¨me : Franchise dÃ©connectÃ©e

**SymptÃ´me:** Dashboard affiche âŒ DÃ©connectÃ©

**Diagnostic:**

1. VÃ©rifier la connectivitÃ© rÃ©seau :
   ```bash
   ping franchise-01.seahawks.local
   ```

2. VÃ©rifier le service Harvester :
   ```bash
   ssh admin@franchise-01.seahawks.local
   sudo systemctl status seahawks-harvester
   ```

3. VÃ©rifier les logs :
   ```bash
   tail -f /opt/monitoring/seahawks-harvester/logs/harvester_*.log
   ```

**Solutions:**

- RedÃ©marrer le service :
  ```bash
  sudo systemctl restart seahawks-harvester
  ```

- VÃ©rifier la configuration rÃ©seau (firewall, proxy)

- VÃ©rifier l'URL du Nester dans `config.json`

### 5.2 ProblÃ¨me : Scan Ã©choue

**SymptÃ´me:** Pas de rapport gÃ©nÃ©rÃ©, erreurs dans les logs

**Diagnostic:**

1. VÃ©rifier nmap :
   ```bash
   nmap --version
   which nmap
   ```

2. Tester manuellement :
   ```bash
   nmap -p 22,80,443 192.168.1.0/24
   ```

3. VÃ©rifier les permissions :
   ```bash
   ls -la /opt/monitoring/seahawks-harvester/reports/
   ```

**Solutions:**

- Installer nmap si manquant :
  ```bash
  sudo apt-get install nmap
  ```

- Donner les capacitÃ©s nÃ©cessaires :
  ```bash
  sudo setcap cap_net_raw,cap_net_admin=eip $(which nmap)
  ```

- VÃ©rifier les permissions des rÃ©pertoires

### 5.3 ProblÃ¨me : Dashboard Nester inaccessible

**SymptÃ´me:** Erreur 502/503 ou timeout

**Diagnostic:**

1. VÃ©rifier le conteneur :
   ```bash
   docker-compose ps
   docker-compose logs nester
   ```

2. VÃ©rifier le port :
   ```bash
   netstat -tlnp | grep 8000
   ```

3. VÃ©rifier Nginx :
   ```bash
   sudo nginx -t
   sudo systemctl status nginx
   ```

**Solutions:**

- RedÃ©marrer le Nester :
  ```bash
  docker-compose restart nester
  ```

- RedÃ©marrer Nginx :
  ```bash
  sudo systemctl restart nginx
  ```

- VÃ©rifier les logs d'erreur Nginx :
  ```bash
  tail -f /var/log/nginx/error.log
  ```

### 5.4 ProblÃ¨me : Upload de rapports Ã©choue

**SymptÃ´me:** Rapports non visibles dans le Nester

**Diagnostic:**

1. Tester l'API manuellement :
   ```bash
   curl -X POST \
     http://nester.seahawks-monitoring.com:8000/api/probe/franchise_01/heartbeat
   ```

2. VÃ©rifier la connectivitÃ© :
   ```bash
   curl http://nester.seahawks-monitoring.com:8000/api/status
   ```

**Solutions:**

- Lancer l'intÃ©gration manuellement :
  ```bash
  python nester_integration.py
  ```

- VÃ©rifier le firewall (port 8000)

- VÃ©rifier l'URL dans config.json

---

## 6. Maintenance

### 6.1 Sauvegarde des donnÃ©es

**Harvester (par franchise):**

```bash
# Sauvegarder les rapports
tar -czf backup_harvester_$(date +%Y%m%d).tar.gz \
  /opt/monitoring/seahawks-harvester/reports \
  /opt/monitoring/seahawks-harvester/logs \
  /opt/monitoring/seahawks-harvester/config.json
```

**Nester (datacenter):**

```bash
# Sauvegarder toutes les donnÃ©es
tar -czf backup_nester_$(date +%Y%m%d).tar.gz \
  /opt/monitoring/seahawks-nester/data
```

**Automatisation (cron):**

```bash
# Ã‰diter crontab
crontab -e

# Ajouter (sauvegarde quotidienne Ã  2h du matin)
0 2 * * * /opt/monitoring/scripts/backup.sh
```

### 6.2 Rotation des logs

Les logs sont gÃ©nÃ©rÃ©s quotidiennement avec le format : `harvester_YYYYMMDD.log`

**Nettoyage manuel (garder 30 jours):**

```bash
find /opt/monitoring/seahawks-harvester/logs -name "*.log" -mtime +30 -delete
find /opt/monitoring/seahawks-nester/data/logs -name "*.log" -mtime +30 -delete
```

### 6.3 Mise Ã  jour du systÃ¨me

**Harvester:**

```bash
# 1. ArrÃªter le service
sudo systemctl stop seahawks-harvester

# 2. Sauvegarder
tar -czf backup_avant_maj.tar.gz /opt/monitoring/seahawks-harvester

# 3. Mettre Ã  jour le code
cd /opt/monitoring/seahawks-harvester
git pull

# 4. Mettre Ã  jour les dÃ©pendances
source venv/bin/activate
pip install -r requirements.txt --upgrade

# 5. RedÃ©marrer
sudo systemctl start seahawks-harvester
sudo systemctl status seahawks-harvester
```

**Nester:**

```bash
# 1. Sauvegarder
tar -czf backup_nester_avant_maj.tar.gz /opt/monitoring/seahawks-nester

# 2. ArrÃªter
docker-compose down

# 3. Mettre Ã  jour
git pull

# 4. Reconstruire et redÃ©marrer
docker-compose up -d --build

# 5. VÃ©rifier
docker-compose logs -f
```

### 6.4 Surveillance proactive

**MÃ©triques Ã  surveiller:**

- Nombre de franchises connectÃ©es (devrait Ãªtre 32)
- Latence WAN moyenne (< 50ms acceptable)
- Taux de rÃ©ussite des scans (> 95%)
- Espace disque disponible (> 20% libre)

**Alertes recommandÃ©es:**

- Franchise dÃ©connectÃ©e > 10 minutes
- Latence WAN > 100ms
- Ã‰chec de scan
- Espace disque < 10%

---

## 7. Contacts et escalade

### 7.1 Niveaux de support

**Niveau 1 (N1) - Helpdesk:**
- VÃ©rification de l'Ã©tat des franchises
- RedÃ©marrage de services
- Consultation de logs

**Niveau 2 (N2) - Support technique:**
- DÃ©pannage avancÃ©
- Analyse de logs
- Configuration rÃ©seau

**Niveau 3 (N3) - IngÃ©nierie:**
- DÃ©veloppement et modifications
- Architecture systÃ¨me
- Incidents critiques

### 7.2 Contacts

**Support N1/N2:**
- Email: support@seahawks-monitoring.com
- TÃ©lÃ©phone: +33 (0)3 XX XX XX XX
- DisponibilitÃ©: 24/7

**Escalade N3:**
- Email: engineering@seahawks-monitoring.com
- On-call: +33 (0)6 XX XX XX XX
- DisponibilitÃ©: Sur incident critique

### 7.3 ProcÃ©dure d'escalade

1. **Incident mineur** : Traitement N1 (< 2h)
2. **Incident majeur** : Escalade N2 si non rÃ©solu en 2h
3. **Incident critique** : Escalade immÃ©diate N3

**Incidents critiques:**
- Plus de 10 franchises dÃ©connectÃ©es
- Panne complÃ¨te du Nester
- Faille de sÃ©curitÃ© dÃ©tectÃ©e
- Perte de donnÃ©es

---

## Annexes

### A. Commandes utiles

```bash
# Statut des services
systemctl status seahawks-harvester
docker-compose ps

# Logs en temps rÃ©el
tail -f /opt/monitoring/seahawks-harvester/logs/*.log
docker-compose logs -f

# Tester l'API
curl http://nester.seahawks-monitoring.com:8000/api/status

# Espace disque
df -h

# Processus en cours
ps aux | grep harvester
```

### B. Structure des rapports JSON

Voir fichier exemple : `example_report.json`

### C. Codes de sortie

- `0` : SuccÃ¨s
- `1` : Erreur gÃ©nÃ©rale
- `2` : Erreur de configuration
- `3` : Erreur rÃ©seau

---

**Document maintenu par:** Ã‰quipe Engineering  
**DerniÃ¨re rÃ©vision:** 26 janvier 2026  
**Version:** 1.0.0
